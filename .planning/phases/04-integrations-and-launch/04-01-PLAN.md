---
phase: 04-integrations-and-launch
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/integrations/bookem-widget.tsx
  - src/lib/constants.ts
  - src/app/book/page.tsx
  - src/app/services/antenatal-classes/page.tsx
  - src/app/services/baby-massage/page.tsx
  - src/app/services/postnatal-support/page.tsx
autonomous: true

must_haves:
  truths:
    - "Visitor can access Bookem booking widget from service pages"
    - "Widget loads without blocking page render"
    - "Alternative contact methods shown when widget unavailable"
    - "Visitor can access dedicated booking page at /book"
    - "Booking widget works correctly on mobile devices"
  artifacts:
    - path: "src/components/integrations/bookem-widget.tsx"
      provides: "Bookem widget wrapper with lazyOnload"
      exports: ["BookemWidget"]
    - path: "src/app/book/page.tsx"
      provides: "Standalone booking page"
      contains: "BookemWidget"
    - path: "src/lib/constants.ts"
      provides: "BOOKEM_CONFIG constant"
      contains: "businessSlug"
  key_links:
    - from: "src/app/services/antenatal-classes/page.tsx"
      to: "BookemWidget"
      via: "import and render"
      pattern: "BookemWidget.*serviceId"
    - from: "src/components/integrations/bookem-widget.tsx"
      to: "next/script"
      via: "Script component with lazyOnload"
      pattern: "strategy=\"lazyOnload\""
---

<objective>
Integrate Bookem booking widget into the site with service pre-selection from service pages.

Purpose: Enable visitors to book appointments directly on the site without navigating away, with service context preserved when coming from service detail pages.
Output: BookemWidget component, /book page, and booking CTAs on service pages.
</objective>

<execution_context>
@/home/codespace/.claude/get-shit-done/workflows/execute-plan.md
@/home/codespace/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-integrations-and-launch/04-RESEARCH.md

# Existing service page structure
@src/app/services/antenatal-classes/page.tsx
@src/lib/constants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Bookem widget component and configuration</name>
  <files>
    src/components/integrations/bookem-widget.tsx
    src/lib/constants.ts
  </files>
  <action>
1. Add BOOKEM_CONFIG to constants.ts:
```typescript
export const BOOKEM_CONFIG = {
  businessSlug: "tendertouchclinic", // Update with actual Bookem slug
  baseUrl: "https://bookem.com",
  // Service ID mapping - update with actual Bookem service IDs
  services: {
    "antenatal-classes": "antenatal",
    "baby-massage": "baby-massage",
    "postnatal-support": "postnatal",
    "lactation": "lactation",
    "newborn-checkups": "checkup",
    "vaccinations": "vaccination",
  },
} as const;
```

2. Create BookemWidget Client Component:
- Use 'use client' directive
- Accept optional serviceId prop for pre-selection
- Use next/script with strategy="lazyOnload" to prevent blocking
- Include container div with min-height for CLS prevention
- Add noscript fallback with direct link to Bookem
- Add error handling with onError callback
- Show loading state while script loads
- Include first-time booker instructions text above widget

Widget should:
- Construct URL with optional service query parameter
- Display loading spinner until widget initializes
- Show fallback message with alternative contact methods (phone, email, WhatsApp) if script fails
- Have min-h-[500px] to reserve space and prevent layout shift

**Mobile optimization (BOOK-03):**
- Ensure container has responsive width (w-full, max-w-none on mobile)
- Touch targets for fallback links must meet 44x44px minimum
- Test scroll behavior - widget should not cause horizontal overflow
- Add overflow-x-hidden to widget container as safeguard
  </action>
  <verify>
- `npm run build` passes
- Component exports BookemWidget
- BOOKEM_CONFIG exists in constants.ts
- Container has min-h-[500px] for CLS prevention
- Fallback links have min-h-[44px] min-w-[44px] for touch targets
  </verify>
  <done>
BookemWidget component created with lazyOnload strategy, fallback handling, mobile-optimized touch targets, and first-time booker instructions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create standalone booking page</name>
  <files>
    src/app/book/page.tsx
  </files>
  <action>
Create /book page that:
1. Has proper metadata (title: "Book an Appointment", description for SEO)
2. Renders BookemWidget component without serviceId (shows all services)
3. Includes introductory text explaining booking process
4. Has Section with Container for consistent styling
5. Includes BOOK-04: Clear instructions for first-time bookers:
   - How to select a service
   - What information they'll need
   - Cancellation/rescheduling policy note
6. Includes BOOK-05: Alternative contact section below widget with:
   - Phone number
   - Email
   - WhatsApp link
   - Text: "Having trouble booking online? Contact us directly."

Page structure:
- Breadcrumb (Home > Book)
- Hero section with title and intro text
- First-time booker instructions
- BookemWidget component
- Alternative contact fallback section

**Mobile verification (BOOK-03):**
After implementation, verify in Chrome DevTools mobile emulation (iPhone SE, Pixel 5):
- Widget container does not cause horizontal scroll
- Touch targets (buttons, links) are at least 44x44px
- Loading/fallback states render correctly on mobile viewport
  </action>
  <verify>
- `npm run build` passes
- Navigate to /book shows booking page
- Page includes BookemWidget
- Alternative contact methods visible
- Chrome DevTools mobile emulation (iPhone SE 375px width): no horizontal overflow, touch targets >= 44px
  </verify>
  <done>
Standalone /book page created with BookemWidget, first-time instructions, fallback contact options, and verified mobile-responsive.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add booking widget to service pages</name>
  <files>
    src/app/services/antenatal-classes/page.tsx
    src/app/services/baby-massage/page.tsx
    src/app/services/postnatal-support/page.tsx
  </files>
  <action>
Update each service detail page to include BookemWidget with service pre-selected:

1. Import BookemWidget and BOOKEM_CONFIG
2. Replace the existing "Book Your Course" button in the CTA section with BookemWidget
3. Pass the appropriate serviceId from BOOKEM_CONFIG.services mapping
4. Keep the "Ask a Question" button linking to /contact
5. Add small text below widget: "Having trouble? Call us at 083 564 1671 or WhatsApp"

For antenatal-classes/page.tsx:
- serviceId={BOOKEM_CONFIG.services["antenatal-classes"]}

For baby-massage/page.tsx:
- serviceId={BOOKEM_CONFIG.services["baby-massage"]}

For postnatal-support/page.tsx:
- serviceId={BOOKEM_CONFIG.services["postnatal-support"]}

Preserve existing page structure - only modify the final CTA section to include embedded widget alongside the existing "Ask a Question" button.
  </action>
  <verify>
- `npm run build` passes
- Service pages render without errors
- BookemWidget appears on service detail pages
- Service pre-selection prop passed correctly
  </verify>
  <done>
Service detail pages updated with embedded BookemWidget and service pre-selection.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Navigate to /book - shows booking widget with instructions
3. Navigate to /services/antenatal-classes - shows booking widget with service pre-selected
4. Disable JavaScript - fallback contact links visible
5. BOOKEM_CONFIG.services contains all service mappings
6. **Mobile verification (BOOK-03):** Open Chrome DevTools, toggle device toolbar (Ctrl+Shift+M), select iPhone SE or Pixel 5:
   - /book page: no horizontal scroll, widget fits viewport
   - Touch targets (fallback links, buttons): minimum 44x44px tap area
   - Test scroll behavior within widget container
</verification>

<success_criteria>
- BookemWidget component uses lazyOnload strategy (non-blocking)
- /book page accessible with standalone booking widget
- Service pages have embedded booking with pre-selection
- Fallback contact methods visible when JavaScript disabled
- First-time booker instructions present on /book page
- Booking widget works correctly on mobile devices (BOOK-03): no overflow, 44px+ touch targets
</success_criteria>

<output>
After completion, create `.planning/phases/04-integrations-and-launch/04-01-SUMMARY.md`
</output>
