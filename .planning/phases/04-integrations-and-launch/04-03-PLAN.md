---
phase: 04-integrations-and-launch
plan: 03
type: execute
wave: 2
depends_on: ["04-01", "04-02"]
files_modified:
  - src/__tests__/a11y/components.test.tsx
  - package.json
  - jest.config.js
autonomous: false

must_haves:
  truths:
    - "Site passes automated WCAG 2.2 AA accessibility checks"
    - "Core components have accessibility test coverage"
    - "LCP is under 2.5s on mobile"
    - "CLS is under 0.1"
  artifacts:
    - path: "src/__tests__/a11y/components.test.tsx"
      provides: "Accessibility test suite"
      contains: "toHaveNoViolations"
    - path: "jest.config.js"
      provides: "Jest configuration for a11y tests"
      contains: "jest-axe"
  key_links:
    - from: "src/__tests__/a11y/components.test.tsx"
      to: "jest-axe"
      via: "import"
      pattern: "from 'jest-axe'"
---

<objective>
Validate accessibility compliance and Core Web Vitals performance before launch.

Purpose: Ensure site meets WCAG 2.2 AA standards and achieves target Core Web Vitals metrics, satisfying Phase 4 success criteria for production readiness.
Output: Accessibility test suite, verification of performance metrics, documented audit results.
</objective>

<execution_context>
@/home/codespace/.claude/get-shit-done/workflows/execute-plan.md
@/home/codespace/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-integrations-and-launch/04-RESEARCH.md

# Existing test setup (if any)
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Set up jest-axe and create accessibility tests</name>
  <files>
    package.json
    jest.config.js
    jest.setup.js
    src/__tests__/a11y/components.test.tsx
  </files>
  <action>
1. Install jest-axe and testing dependencies:
   `pnpm add --save-dev jest-axe @types/jest-axe @testing-library/react @testing-library/jest-dom jest jest-environment-jsdom`

2. Create or update jest.config.js:
```javascript
const nextJest = require('next/jest');

const createJestConfig = nextJest({
  dir: './',
});

const customJestConfig = {
  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],
  testEnvironment: 'jest-environment-jsdom',
  moduleNameMapper: {
    '^@/(.*)$': '<rootDir>/src/$1',
  },
};

module.exports = createJestConfig(customJestConfig);
```

3. Create jest.setup.js:
```javascript
import '@testing-library/jest-dom';
import { toHaveNoViolations } from 'jest-axe';

expect.extend(toHaveNoViolations);
```

4. Create accessibility test suite at src/__tests__/a11y/components.test.tsx:
```typescript
import { render } from '@testing-library/react';
import { axe } from 'jest-axe';
import { Button } from '@/components/ui/button';
import { Footer } from '@/components/layout/footer';
import { Container } from '@/components/ui/container';
import { Section } from '@/components/ui/section';

// Configure axe for WCAG 2.2 AA
const axeOptions = {
  runOnly: {
    type: 'tag' as const,
    values: ['wcag2a', 'wcag2aa', 'wcag21a', 'wcag21aa', 'wcag22aa'],
  },
  rules: {
    // Disable rules that need full page context
    region: { enabled: false },
    'page-has-heading-one': { enabled: false },
  },
};

describe('Accessibility Tests', () => {
  describe('Button component', () => {
    it('has no accessibility violations', async () => {
      const { container } = render(<Button>Click me</Button>);
      const results = await axe(container, axeOptions);
      expect(results).toHaveNoViolations();
    });

    it('has no violations when rendered as link', async () => {
      const { container } = render(<Button href="/test">Link button</Button>);
      const results = await axe(container, axeOptions);
      expect(results).toHaveNoViolations();
    });
  });

  describe('Footer component', () => {
    it('has no accessibility violations', async () => {
      const { container } = render(<Footer />);
      const results = await axe(container, axeOptions);
      expect(results).toHaveNoViolations();
    });
  });

  describe('Layout components', () => {
    it('Container has no violations', async () => {
      const { container } = render(
        <Container>
          <p>Content</p>
        </Container>
      );
      const results = await axe(container, axeOptions);
      expect(results).toHaveNoViolations();
    });

    it('Section has no violations', async () => {
      const { container } = render(
        <Section>
          <p>Content</p>
        </Section>
      );
      const results = await axe(container, axeOptions);
      expect(results).toHaveNoViolations();
    });
  });
});
```

5. Add test script to package.json:
```json
"scripts": {
  "test": "jest",
  "test:a11y": "jest --testPathPattern=a11y"
}
```
  </action>
  <verify>
- `pnpm add` commands succeed
- `npm run test:a11y` runs tests
- All accessibility tests pass
  </verify>
  <done>
jest-axe configured with WCAG 2.2 AA rules, accessibility tests passing for core components.
  </done>
</task>

<task type="auto">
  <name>Task 2: Run build and capture performance baseline</name>
  <files>
    (no files modified - verification only)
  </files>
  <action>
1. Run production build:
   `npm run build`

2. Start production server:
   `npm run start` (in background)

3. Document build output metrics:
   - Note bundle sizes from build output
   - Capture any build warnings

4. Run Lighthouse CLI (if available) or document for manual PageSpeed check:
   `npx lighthouse http://localhost:3000 --output=json --output-path=./lighthouse-report.json --only-categories=performance,accessibility`

   If Lighthouse CLI unavailable, document the URLs to test manually:
   - Homepage: /
   - Service page: /services/antenatal-classes
   - Contact: /contact
   - Book: /book

5. Create performance baseline document at .planning/phases/04-integrations-and-launch/PERFORMANCE.md:
   - Build size metrics
   - Target: LCP < 2.5s, CLS < 0.1
   - Pages to verify in PageSpeed Insights
  </action>
  <verify>
- `npm run build` succeeds
- Production server starts
- Performance baseline documented
  </verify>
  <done>
Production build verified, performance baseline captured and documented.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 4 implementation:
1. Bookem booking widget integrated on /book page and service pages
2. WhatsApp button has non-clinical disclaimer tooltip
3. Cookie consent banner appears for new visitors
4. Accessibility test suite with jest-axe
  </what-built>
  <how-to-verify>
**Step 1: Test Booking Widget**
1. Navigate to http://localhost:3000/book
2. Verify booking widget loads (or shows fallback if Bookem not configured)
3. Verify first-time booker instructions visible
4. Verify alternative contact methods shown below widget
5. Navigate to /services/antenatal-classes - verify widget appears with service context

**Step 2: Test WhatsApp Disclaimer**
1. Hover over WhatsApp button (bottom-right)
2. Verify tooltip shows "For general inquiries only" or similar disclaimer
3. Click button - verify WhatsApp opens with pre-filled message

**Step 3: Test Cookie Consent**
1. Open site in incognito/private window
2. Verify cookie banner appears at bottom
3. Click Accept - banner should disappear
4. Refresh page - banner should stay hidden
5. Clear cookies, refresh - banner should reappear

**Step 4: Run Accessibility Tests**
1. Run `npm run test:a11y`
2. Verify all tests pass

**Step 5: Check Core Web Vitals (Manual)**
1. Go to https://pagespeed.web.dev/
2. Enter production URL (or localhost via ngrok if not deployed)
3. Run mobile analysis
4. Verify: LCP < 2.5s, CLS < 0.1

**Step 6: Manual Keyboard Navigation**
1. Tab through homepage - verify logical focus order
2. Verify focus indicators visible on all interactive elements
3. Test mobile menu with keyboard (Enter to open, Escape to close)
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. `npm run test:a11y` - all accessibility tests pass
2. `npm run build` - production build succeeds
3. Manual verification of booking widget, WhatsApp disclaimer, cookie consent
4. PageSpeed Insights shows LCP < 2.5s, CLS < 0.1 (or document actual values)
5. Keyboard navigation works throughout site
</verification>

<success_criteria>
- Automated accessibility tests pass with WCAG 2.2 AA rules
- Production build completes without errors
- Core Web Vitals targets met (LCP < 2.5s, CLS < 0.1)
- Human verification confirms all Phase 4 features working
- Site ready for production deployment
</success_criteria>

<output>
After completion, create `.planning/phases/04-integrations-and-launch/04-03-SUMMARY.md`
</output>
