---
phase: 04-integrations-and-launch
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/layout/whatsapp-button.tsx
  - src/components/layout/cookie-consent.tsx
  - src/app/layout.tsx
  - package.json
autonomous: true

must_haves:
  truths:
    - "WhatsApp button shows disclaimer that it's for non-clinical inquiries"
    - "Cookie consent banner appears for new visitors"
    - "Cookie consent respects user choice and persists"
  artifacts:
    - path: "src/components/layout/whatsapp-button.tsx"
      provides: "WhatsApp button with disclaimer tooltip"
      contains: "non-clinical"
    - path: "src/components/layout/cookie-consent.tsx"
      provides: "Cookie consent banner component"
      exports: ["CookieConsentBanner"]
    - path: "src/app/layout.tsx"
      provides: "Layout with cookie consent"
      contains: "CookieConsentBanner"
  key_links:
    - from: "src/app/layout.tsx"
      to: "CookieConsentBanner"
      via: "import and render"
      pattern: "<CookieConsentBanner"
    - from: "src/components/layout/cookie-consent.tsx"
      to: "react-cookie-consent"
      via: "npm package"
      pattern: "from 'react-cookie-consent'"
---

<objective>
Add WhatsApp disclaimer for non-clinical inquiries and implement cookie consent banner for GDPR/POPIA compliance.

Purpose: Clarify WhatsApp use case to prevent inappropriate medical inquiries and ensure legal compliance with cookie/privacy regulations.
Output: Updated WhatsApp button with CSS-only tooltip, cookie consent banner component wired into layout.
</objective>

<execution_context>
@/home/codespace/.claude/get-shit-done/workflows/execute-plan.md
@/home/codespace/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-integrations-and-launch/04-RESEARCH.md

# Existing WhatsApp implementation
@src/components/layout/whatsapp-button.tsx
@src/app/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update WhatsApp button with non-clinical disclaimer (CSS-only tooltip)</name>
  <files>
    src/components/layout/whatsapp-button.tsx
  </files>
  <action>
Update WhatsApp button to include WHATS-03 disclaimer using CSS-only tooltip.

**IMPORTANT: Keep this as a Server Component.** The existing implementation is documented as "Server Component - no client-side interactivity needed". Use pure CSS for the tooltip to maintain this.

CSS-only tooltip implementation:
1. Wrap the link in a div with `group` and `relative` classes
2. Add a span element for the tooltip that is:
   - Positioned absolutely above the button
   - Hidden by default (`opacity-0 invisible`)
   - Shown on group hover/focus-within (`group-hover:opacity-100 group-hover:visible group-focus-within:opacity-100 group-focus-within:visible`)
   - Has smooth transition (`transition-opacity duration-200`)
3. Tooltip text: "General inquiries only" (line 1), "Not for medical advice" (line 2)
4. Update aria-label to: "Chat with us on WhatsApp for general inquiries"
5. Keep existing styling and positioning (fixed bottom-6 right-6 z-40)
6. Maintain 56x56px touch target (w-14 h-14)

Tooltip styling:
- Background: neutral-800 with slight transparency
- Text: white, text-xs
- Padding: px-3 py-2
- Rounded corners: rounded-lg
- Positioned: bottom-full mb-2 right-0
- Min-width: min-w-max or fixed width
- Add small arrow/caret pointing down using ::after pseudo-element or a small div

Do NOT add 'use client' directive. Pure CSS hover states work in Server Components.
  </action>
  <verify>
- `npm run build` passes (no 'use client' directive needed)
- Hover over WhatsApp button shows disclaimer tooltip
- aria-label includes "general inquiries" text
- Button still functions (opens WhatsApp link)
- Component remains a Server Component (no useState, useEffect, event handlers)
  </verify>
  <done>
WhatsApp button updated with CSS-only tooltip showing non-clinical inquiry disclaimer. Server Component preserved.
  </done>
</task>

<task type="auto">
  <name>Task 2: Install react-cookie-consent and create banner component</name>
  <files>
    package.json
    src/components/layout/cookie-consent.tsx
  </files>
  <action>
1. Install react-cookie-consent:
   `pnpm add react-cookie-consent`

2. Create CookieConsentBanner component:
```typescript
'use client';

import CookieConsent from 'react-cookie-consent';
import Link from 'next/link';

export function CookieConsentBanner() {
  return (
    <CookieConsent
      location="bottom"
      buttonText="Accept"
      declineButtonText="Decline"
      enableDeclineButton
      cookieName="ttc-cookie-consent"
      expires={365}
      style={{
        background: '#1e293b', // neutral-800
        color: '#f1f5f9', // neutral-100
        padding: '1rem',
        alignItems: 'center',
      }}
      buttonStyle={{
        background: '#0d9488', // primary-500
        color: 'white',
        borderRadius: '0.5rem',
        padding: '0.5rem 1.5rem',
        fontWeight: '500',
      }}
      declineButtonStyle={{
        background: 'transparent',
        border: '1px solid #94a3b8', // neutral-400
        color: '#f1f5f9',
        borderRadius: '0.5rem',
        padding: '0.5rem 1.5rem',
      }}
      ariaAcceptLabel="Accept cookies"
      ariaDeclineLabel="Decline cookies"
    >
      We use cookies to enhance your browsing experience.{' '}
      <Link href="/privacy" className="underline hover:text-primary-300">
        Learn more
      </Link>
    </CookieConsent>
  );
}
```

Component must:
- Use 'use client' directive (required for react-cookie-consent interactivity)
- Position at bottom (overlays, doesn't push content - prevents CLS)
- Include Accept and Decline buttons
- Link to /privacy page
- Use brand colors matching design system
- Have proper ARIA labels for accessibility
  </action>
  <verify>
- `pnpm add react-cookie-consent` succeeds
- `npm run build` passes
- Component exports CookieConsentBanner
  </verify>
  <done>
react-cookie-consent installed and CookieConsentBanner component created with brand styling.
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire cookie consent into root layout</name>
  <files>
    src/app/layout.tsx
  </files>
  <action>
Update root layout to include CookieConsentBanner:

1. Import CookieConsentBanner from '@/components/layout/cookie-consent'
2. Add component at end of body, after WhatsAppButton
3. Position in render order: Header, main, Footer, WhatsAppButton, CookieConsentBanner

The banner should be the last element so it overlays at bottom without affecting other fixed elements. Cookie consent banner uses position:fixed internally, so no additional positioning needed.

Layout structure:
```tsx
<body>
  <SkipLink />
  <Header />
  <main>{children}</main>
  <Footer />
  <WhatsAppButton />
  <CookieConsentBanner />
  {/* JSON-LD script */}
</body>
```
  </action>
  <verify>
- `npm run build` passes
- Visit site in incognito - cookie banner appears
- Click Accept - banner disappears
- Refresh - banner stays hidden (cookie persisted)
- Click Decline - banner disappears and preference saved
  </verify>
  <done>
Cookie consent banner wired into root layout, appears for new visitors and persists choice.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Hover over WhatsApp button - disclaimer tooltip visible (CSS-only, no JS)
3. New visitor sees cookie consent banner
4. Accept/Decline saves preference (check cookie: ttc-cookie-consent)
5. WhatsApp button aria-label mentions "general inquiries"
6. WhatsApp button component has NO 'use client' directive (remains Server Component)
</verification>

<success_criteria>
- WhatsApp button has visible disclaimer for non-clinical inquiries (WHATS-03)
- WhatsApp button remains a Server Component (CSS-only tooltip implementation)
- Cookie consent banner appears for new visitors (LEGAL-03)
- User preference persists after Accept/Decline
- Privacy policy linked in consent banner
- No layout shift when banner appears (position:fixed)
</success_criteria>

<output>
After completion, create `.planning/phases/04-integrations-and-launch/04-02-SUMMARY.md`
</output>
